<!DOCTYPE html>
<html>
<head>
  <title><%= episode.name %> powered by Bethel</title>
  <link rel="stylesheet" href="/components/videojs/dist/video-js.min.css" />
  <link rel="stylesheet" href="/styles/embed.css" />
  <style>
    #embed-frame #embedded.vjs-bethel-skin {
<% if (podcast.embedSettings && podcast.embedSettings.backgroundColor) { %>
      background: <%= podcast.embedSettings.backgroundColor %>
<% } else { %>
      background-image: url('https://images.bethel.io/images/<%= podcast.image ? podcast.image : 'DefaultPodcaster.png' %>?crop=faces&fit=crop&w=200&h=200&blur=150');
<% } %>
    }
<% if (podcast.embedSettings) { %>
    .meta, .meta small, .extras a {
      <% if (podcast.embedSettings.textColor) { %>color: <%= podcast.embedSettings.textColor %> !important;<% } %>
    }
    .video-js.vjs-bethel-skin {
      <% if (podcast.embedSettings.controlColor) { %>color: <%= podcast.embedSettings.controlColor %> !important;<% } %>
    }
    .video-js.vjs-bethel-skin .vjs-progress-control .vjs-play-progress,
    .video-js.vjs-bethel-skin .vjs-volume-level,
    .video-js.vjs-bethel-skin .vjs-mouse-display,
    .video-js.vjs-bethel-skin .vjs-mouse-display:after {
      <% if (podcast.embedSettings.controlColor) { %>background: <%= podcast.embedSettings.controlColor %>;<% } %>
    }

    .video-js.vjs-bethel-skin .vjs-progress-control .vjs-progress-holder {
      <% if (podcast.embedSettings.sliderColor) { %>background: <%= podcast.embedSettings.sliderColor %>;<% } %>
    }
<% } %>
  </style>
</head>
<body id="embed-frame">
<% if (podcast.type == 1) { %>

  <audio id="embedded" class="video-js vjs-bethel-skin" <% if (podcast.embedSettings && podcast.embedSettings.feedUrl) { %>feed="<%= podcast.embedSettings.feedUrl %>" <% } %>controls height="140" poster="https://images.bethel.io/images/<%= podcast.image ? podcast.image : 'DefaultPodcaster.png' %>?crop=faces&fit=crop&w=140&h=140" preload="auto">
    <source src="/podcastmedia/download/<%= episode.id %>?embed" type="audio/mp3" />
    <p class="vjs-no-js">Please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
  </audio>

  <div class="meta">
    <h1><%= episode.name %></h1>
    <h2><%= podcast.name %><br /><small><%= episode.date.toLocaleDateString() %></small></h2>
  </div>

<% } else { %>

  <video id="embedded" class="video-js vjs-bethel-skin" controls<% if (podcast.embedSettings && podcast.embedSettings.feedUrl) { %> feed="<%= podcast.embedSettings.feedUrl %>"<% } %>>
    <source src="/podcastmedia/download/<%= episode.id %>?embed" type="video/mp4" />
    <p class="vjs-no-js">Please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
  </video>

<% } %>

  <script src="/components/videojs/dist/video.min.js"></script>
  <script>
    (function(){
      var VJSButton = videojs.getComponent('Button');

      var DownloadButton = videojs.extend(VJSButton, {
        constructor: function(player, options) {
          VJSButton.call(this, player, options);
          this.controlText('Download');
          this.addClass('vjs-download-button');
        },
        handleClick: function() {
          window.location.href = '/podcastmedia/download/<%= episode.id %>';
        }
      });

      var FeedButton = videojs.extend(VJSButton, {
        feedUrl: '',
        constructor: function(player, options) {
          if (!player.options().feed) return;
          feedUrl = player.options().feed;
          VJSButton.call(this, player, options);
          this.controlText('Subscribe');
          this.addClass('vjs-subscribe-button');
        },
        handleClick: function() {
          window.open(this.feedUrl, '_blank');
        }
      });

      videojs.registerComponent('FeedButton', FeedButton);
      videojs.registerComponent('DownloadButton', DownloadButton);

      videojs.options.flash.swf = "https://static.bethel.io/libraries/video-js/video-js.swf";
      videojs('embedded', {
        controlBar: {
          fullscreenToggle: false
        }
      }, function() {
        this.controlBar.addChild('DownloadButton');
        this.controlBar.addChild('FeedButton');
      });
    })()
  </script>
</body>
</html>
